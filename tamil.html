<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡Æµ‡Æø‡Æü‡ØÅ‡Æï‡Æ§‡Øà ‡Æµ‡Æø‡Æ©‡Ææ‡Æü‡Æø ‡Æµ‡Æø‡Æ©‡Ææ - Kadi Jokes Quiz</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Font suitable for Tamil and a fun look */
        @import url('https://fonts.googleapis.com/css2?family=Baloo+Chettan+2:wght@600;800&display=swap');
        
        :root {
            /* DARK MODE (Default) */
            --bg-color: #0f172a;
            --text-color: #f8fafc;
            --card-bg-start: #1e293b;
            --card-bg-end: #0f172a;
            --joke-bg: #1f2937;
            --header-color: #facc15; /* Yellow-400 */
            --accent-color: #f97316; /* Orange-500 */
            --button-shadow: #c2410c; /* Dark Orange */
            --nav-button-bg: #3b82f6;
            --nav-button-shadow: #1d4ed8;
            --emoji-opacity: 0.05;
        }

        [data-theme='light'] {
            /* LIGHT MODE */
            --bg-color: #f1f5f9; /* Slate-100 */
            --text-color: #1f2937;
            --card-bg-start: #ffffff;
            --card-bg-end: #f8fafc;
            --joke-bg: #e2e8f0;
            --header-color: #fb923c; /* Orange-400 */
            --accent-color: #ea580c; /* Orange-600 */
            --button-shadow: #c2410c;
            --nav-button-bg: #1e40af;
            --nav-button-shadow: #1e3a8a;
            --emoji-opacity: 0.1;
        }

        body {
            font-family: 'Baloo Chettan 2', cursive;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            
            /* Emoji Background Pattern */
            background-image: repeating-linear-gradient(
                45deg, 
                rgba(255, 255, 255, var(--emoji-opacity)) 0, 
                rgba(255, 255, 255, var(--emoji-opacity)) 5px, 
                transparent 5px, 
                transparent 10px
            ),
            url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='10' y='30' font-size='20'%3Eüí°%3C/text%3E%3Ctext x='50' y='70' font-size='20'%3Eü§î%3C/text%3E%3Ctext x='80' y='10' font-size='20'%3EüòÇ%3C/text%3E%3C/svg%3E");
            background-size: 150px, 80px;
            background-repeat: repeat, repeat;
            background-attachment: fixed;
        }
        
        .card {
            background: linear-gradient(145deg, var(--card-bg-start), var(--card-bg-end));
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.6);
            border: 3px solid var(--accent-color);
        }

        .joke-container {
            background-color: var(--joke-bg);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .button-style {
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4px 0 0 var(--button-shadow); /* 3D effect */
            user-select: none;
        }

        .button-style:active {
            box-shadow: 0 0px 0 0 var(--button-shadow);
            transform: translateY(4px);
        }

        .level-button:hover, .time-button:hover, #dark-mode-toggle:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        .selected {
            border: 4px solid #3b82f6 !important; /* Blue-500 border for selected state */
            transform: scale(1.05);
            box-shadow: 0 6px 0 0 #1d4ed8;
        }
        
        /* Timer Indicator Styling */
        #timer-bar-container {
            background-color: var(--joke-bg);
        }

        #timer-bar {
            /* Colors handled dynamically in JS */
            transition: width 0.1s linear;
        }

        .disabled-nav {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none !important;
            transform: none !important;
            background-color: var(--nav-button-bg) !important;
        }
        .nav-button-style {
            box-shadow: 0 4px 0 0 var(--nav-button-shadow);
            background-color: var(--nav-button-bg);
        }
    </style>
</head>
<body data-theme="dark" class="min-h-screen flex items-center justify-center p-4">

    <div id="app-container" class="w-full max-w-xl mx-auto card p-6 md:p-8 rounded-xl">

        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl md:text-4xl font-extrabold text-center tracking-wide" style="color: var(--header-color);">
                ‡Æµ‡Æø‡Æü‡ØÅ‡Æï‡Æ§‡Øà ‡Æµ‡Æø‡Æ©‡Ææ‡Æü‡Æø ‡Æµ‡Æø‡Æ©‡Ææ
            </h1>
            <!-- Dark/Light Mode Toggle Button -->
            <button id="dark-mode-toggle" onclick="toggleDarkMode()" 
                    class="p-2 rounded-full text-xl transition-colors duration-300 button-style" 
                    style="background-color: var(--joke-bg); color: var(--text-color); box-shadow: 0 3px 0 0 var(--button-shadow);">
                üåô
            </button>
        </div>
        
        <!-- --- Start Screen --- -->
        <div id="start-screen" class="screen">
            <p class="text-center mb-8 text-xl" style="color: var(--text-color);">
                ‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.
            </p>

            <!-- Time Selection -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-4" style="color: var(--accent-color);">‡Æ®‡Øá‡Æ∞‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ (Time Limit per Joke):</h2>
                <div id="time-options" class="grid grid-cols-3 gap-4">
                    <!-- Buttons will be generated here -->
                </div>
            </div>

            <!-- Level Selection -->
            <div class="mb-10">
                <!-- MODIFIED LINE: Removed "(... 100 Questions Each)" -->
                <h2 class="text-2xl font-bold mb-4" style="color: var(--accent-color);">‡Æï‡Æü‡Æø‡Æ© ‡Æ®‡Æø‡Æ≤‡Øà (Difficulty Level):</h2>
                <div id="level-options" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Buttons will be generated here -->
                </div>
            </div>

            <!-- Start Button -->
            <button id="start-game-button" onclick="startGame()" disabled class="button-style w-full bg-gray-500 cursor-not-allowed text-white font-extrabold py-4 rounded-xl text-2xl opacity-70">
                ‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ (Start Game)
            </button>
        </div>

        <!-- --- Game Screen --- -->
        <div id="game-screen" class="screen hidden">
            <!-- Score & Timer Display -->
            <div class="flex justify-between items-center mb-4">
                <div class="text-xl font-bold text-green-400">‡Æ∏‡Øç‡Æï‡Øã‡Æ∞‡Øç: <span id="score-display">0</span></div>
                <div class="text-xl font-bold text-red-400">‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç: <span id="timer-display">0</span> ‡Æµ‡Æø‡Æ©‡Ææ‡Æü‡Æø‡Æï‡Æ≥‡Øç</div>
            </div>
            
            <!-- Timer Bar -->
            <div id="timer-bar-container" class="mb-6 rounded-lg">
                <div id="timer-bar" class="rounded-lg"></div>
            </div>
            
            <!-- Joke Display Area -->
            <div class="joke-container p-6 rounded-lg mb-6 min-h-[160px] flex flex-col justify-center relative shadow-inner">
                
                <p class="font-bold text-xl mb-3" style="color: var(--accent-color);">‡Æ®‡Æø‡Æ≤‡Øà: <span id="level-indicator" class="text-yellow-300"></span></p>
                <p id="joke-question" class="text-2xl leading-relaxed" style="color: var(--text-color);">
                    <!-- Joke question goes here -->
                </p>
            </div>

            <!-- Options Container -->
            <div id="options-container" class="grid grid-cols-1 gap-3">
                <!-- Option buttons will be generated here -->
            </div>
            
            <!-- Navigation Buttons -->
            <div class="flex justify-between mt-6 gap-4">
                <button id="prev-button" onclick="goToPreviousJoke()" disabled class="nav-button-style text-white font-extrabold py-3 rounded-xl text-lg w-1/2 disabled-nav">
                    ‚Üê ‡ÆÆ‡ØÅ‡Æ®‡Øç‡Æ§‡Øà‡ÆØ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø
                </button>
                <button id="next-button" onclick="goToNextJoke()" class="nav-button-style bg-orange-600 hover:bg-orange-700 text-white font-extrabold py-3 rounded-xl text-lg w-1/2">
                    ‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø ‚Üí
                </button>
            </div>
        </div>

        <!-- --- End Screen --- -->
        <div id="end-screen" class="screen hidden text-center">
            <h2 class="text-4xl font-extrabold text-red-400 mb-6">‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ!</h2>
            <p class="text-2xl mb-8" style="color: var(--text-color);">‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ± ‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§ ‡Æ∏‡Øç‡Æï‡Øã‡Æ∞‡Øç:</p>
            <p id="final-score-display" class="text-7xl font-black text-yellow-400 mb-10">0</p>
            <button onclick="window.location.reload()" class="button-style w-full bg-orange-600 hover:bg-orange-700 text-white font-extrabold py-4 rounded-xl text-2xl">
                ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ (Restart Game)
            </button>
        </div>

    </div>

    <script>
        // Base set of Kadi Jokes (approximately 10 per level)
        const BASE_JOKES = [
            // Easy - Simple wordplay, obvious answers
            { q: "‡Æé‡Æ§‡ØÅ ‡Æ™‡Æ£‡Øç‡Æ£‡Æø‡Æ©‡Ææ‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æö‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æ™‡Øã‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§ ‡Æµ‡Æø‡Æ∑‡ÆØ‡ÆÆ‡Øç ‡Æé‡Æ§‡ØÅ?", a: "‡Æ§‡ØÇ‡Æô‡Øç‡Æï‡ØÅ‡Æ±‡Æ§‡ØÅ", level: "Easy" },
            { q: "‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï ‡Æí‡Æ∞‡ØÅ ‡Æï‡Æ£‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç, ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç ‡ÆÖ‡Æ§‡ØÅ ‡ÆÆ‡Æ©‡ØÅ‡Æ∑‡Æ©‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà. ‡ÆÖ‡Æ§‡ØÅ ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æä‡Æö‡Æø", level: "Easy" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ ‡Æâ‡ÆØ‡Æø‡Æ∞‡Æø‡Æ©‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æá‡Æ∞‡Æ£‡Øç‡Æü‡ØÅ ‡Æï‡Øà‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡ØÅ‡ÆÆ‡Øç, ‡Æé‡Æ¥‡ØÅ‡Æ§ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æï‡Øà‡Æï‡Øç‡Æï‡ØÅ‡Æü‡Øç‡Æü‡Øà", level: "Easy" },
            { q: "‡Æµ‡ØÜ‡Æü‡Øç‡Æü ‡Æµ‡ØÜ‡Æü‡Øç‡Æü ‡Æµ‡Æ≥‡Æ∞‡ØÅ‡ÆÆ‡Øç, ‡ÆÖ‡Æ§‡ØÅ ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æ§‡Æ≤‡Øà‡ÆÆ‡ØÅ‡Æü‡Æø", level: "Easy" },
            { q: "‡Æé‡Æ§‡Øà ‡Æï‡ØÄ‡Æ¥‡Øá ‡Æ™‡Øã‡Æü‡Øç‡Æü‡Ææ‡Æ≤‡Øç ‡ÆÆ‡Øá‡Æ≤‡Øá ‡Æé‡Æ¥‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡ÆÆ‡Øç?", a: "‡Æ™‡Æ®‡Øç‡Æ§‡ØÅ", level: "Easy" },
            { q: "‡Æ™‡Æ≤‡Øç‡Æ≤‡ØÅ ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æö‡Ææ‡Æ™‡Øç‡Æ™‡Æø‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ, ‡ÆÖ‡Æ§‡ØÅ ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æö‡ØÄ‡Æ™‡Øç‡Æ™‡ØÅ", level: "Easy" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ ‡ÆÖ‡Æ±‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡Æï‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà, ‡Æú‡Æ©‡Øç‡Æ©‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà?", a: "‡Æï‡Ææ‡Æ±‡Øç‡Æ±‡Æ±‡Øà", level: "Easy" },
            { q: "‡Æâ‡Æ≥‡Øç‡Æ≥‡Øá ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æö‡Æø‡Æµ‡Æ™‡Øç‡Æ™‡ØÅ, ‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá ‡Æµ‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æµ‡ØÜ‡Æ≥‡Øç‡Æ≥‡Øà. ‡ÆÖ‡Æ§‡ØÅ ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æö‡ØÇ‡ÆØ‡Æø‡Æô‡Øç‡Æï‡ÆÆ‡Øç", level: "Easy" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡ÆÆ‡Ææ'‡Æµ‡Øà ‡Æö‡Ææ‡Æ™‡Øç‡Æ™‡Æø‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡ÆÆ‡Æï‡Æø‡Æ¥‡Øç‡Æö‡Øç‡Æö‡Æø", level: "Easy" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æï‡Ææ‡ÆØ‡Øç'‡ÆØ‡Øà ‡Æµ‡Øá‡Æï‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æö‡Ææ‡Æ™‡Øç‡Æ™‡Æø‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æï‡Ææ‡ÆØ‡Øç‡Æï‡Æ±‡Æø ‡Æï‡Æü‡Øà", level: "Easy" },
            
            // Intermediate - Standard kadi jokes, average lateral thinking
            { q: "‡Æ®‡Ææ‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà, ‡Æ®‡ØÄ‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà. ‡ÆÖ‡Æ™‡Øç‡Æ™‡ØÅ‡Æ±‡ÆÆ‡Øç ‡ÆØ‡Ææ‡Æ∞‡ØÅ ‡ÆÖ‡Æ®‡Øç‡Æ§ ‡Æï‡ØÅ‡Æ¥‡Æ®‡Øç‡Æ§‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡ÆÖ‡Æ™‡Øç‡Æ™‡Ææ?", a: "‡ÆÖ‡Æ®‡Øç‡Æ§ ‡Æï‡ØÅ‡Æ¥‡Æ®‡Øç‡Æ§‡Øà‡ÆØ‡Øã‡Æü ‡ÆÖ‡Æ™‡Øç‡Æ™‡Ææ", level: "Intermediate" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ ‡Æï‡Æü‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Øá ‡Æí‡Æ∞‡ØÅ ‡Æ§‡ØÅ‡Æ≥‡Æø ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æï‡ØÇ‡Æü ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà?", a: "‡Æµ‡Ææ‡Æ©‡Æ§‡Øç‡Æ§‡ØÅ ‡Æï‡Æü‡Æ≤‡Øç", level: "Intermediate" },
            { q: "‡Æâ‡Æü‡Øà‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øá ‡Æµ‡Øá‡Æ≤‡Øà ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ≥‡Øç ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡ÆÆ‡ØÅ‡Æü‡Øç‡Æü‡Øà", level: "Intermediate" },
            { q: "‡Æâ‡Æ©‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øá ‡Æö‡Øä‡Æ®‡Øç‡Æ§‡ÆÆ‡Ææ‡Æ©, ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ§‡Øà ‡ÆÖ‡Æ§‡Æø‡Æï‡ÆÆ‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ≥‡Øç ‡Æé‡Æ§‡ØÅ?", a: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç", level: "Intermediate" },
            { q: "‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øá ‡Æ™‡Øã‡Æï‡ØÅ‡ÆÆ‡Øç, ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æø ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÅ?", a: "‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç", level: "Intermediate" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ ‡Æö‡Ææ‡Æµ‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡ØÇ‡Æü‡Øç‡Æü‡ØÅ ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà?", a: "‡Æö‡Ææ‡Æµ‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ∞‡Æ©‡Øç", level: "Intermediate" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ ‡Æ™‡Øä‡Æ§‡Øç‡Æ§‡Ææ‡Æ©‡Øç (Button) ‡Æö‡Æü‡Øç‡Æü‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÅ?", a: "‡Æö‡ØÅ‡Æµ‡Æø‡Æü‡Øç‡Æö‡Øç", level: "Intermediate" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æï‡Øà'‡ÆØ‡Ææ‡Æ≤‡Øç ‡Æ§‡Æü‡Øç‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æï‡Øà‡Æ§‡Æø", level: "Intermediate" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æ™‡Æü‡Øç‡Æü‡Æø'‡ÆØ‡Øà ‡Æö‡Æü‡Øç‡Æü‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Øã‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æ∞‡ÆØ‡Æø‡Æ≤‡Øç‡Æµ‡Øá ‡Æ™‡Æü‡Øç‡Æü‡Æø", level: "Intermediate" },
            { q: "‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æï‡ØÅ‡Æ≥‡Æø‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø‡ÆØ‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç, ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç ‡ÆØ‡Ææ‡Æ∞‡ØÅ‡ÆÆ‡Øç ‡Æé‡Æ©‡Øç‡Æ©‡Øà ‡Æï‡ØÅ‡Æü‡Æø‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ. ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æï‡ØÅ‡Æ≥‡Æø‡Æ∞‡Øç ‡Æö‡Ææ‡Æ§‡Æ©‡Æ™‡Øç ‡Æ™‡ØÜ‡Æü‡Øç‡Æü‡Æø", level: "Intermediate" },

            // Hard - More obscure, requires deeper word association
            { q: "‡Æµ‡Ææ‡Æ¥‡Øç‡Æï‡Øç‡Æï‡Øà ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡Æµ‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æâ‡Æ©‡Øç‡Æ©‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç, ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç ‡Æâ‡Æ©‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æí‡Æ∞‡ØÅ ‡Æµ‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Øà ‡Æï‡ØÇ‡Æü ‡Æ™‡Øá‡Æö‡Ææ‡Æ§‡ØÅ. ‡ÆÖ‡Æ§‡ØÅ ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æ®‡Æø‡Æ¥‡Æ≤‡Øç", level: "Hard" },
            { q: "‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æö‡Æø‡ÆØ‡Øã‡Æü‡ØÅ ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç, ‡Æé‡Æ©‡Øç‡Æ©‡Øà ‡Æé‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡Æµ‡Æ∞‡Øà ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ§‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡ÆÆ‡Ææ‡Æü‡Øç‡Æü‡Øá‡Æ©‡Øç. ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æ®‡ØÜ‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ", level: "Hard" },
            { q: "‡Æé‡Æ§‡Øà ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æø‡Æ©‡Ææ‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ¥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç?", a: "‡Æï‡Æ∞‡Æø", level: "Hard" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡ÆÆ‡Øà'‡ÆØ‡Ææ‡Æ≤‡Øç ‡Æé‡Æ¥‡ØÅ‡Æ§ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡ÆÆ‡ÆØ‡Æø‡Æ≤‡Øç", level: "Hard" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æï‡ÆÆ‡Øç'‡ÆÆ‡Øà ‡Æí‡Æü‡Øç‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æö‡ØÅ‡Æï‡Æ∞‡Øç ‡Æï‡ÆÆ‡Øç", level: "Hard" },
            { q: "‡Æâ‡Æü‡Øà ‡Æá‡Æ≤‡Øç‡Æ≤‡Ææ‡ÆÆ‡Æ≤‡Øç ‡Æ®‡Æü‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç, ‡ÆÖ‡Æ§‡ØÅ ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æï‡Æ£‡Øç‡Æ£‡Ææ‡Æü‡Æø", level: "Hard" },
            { q: "‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øá ‡Æà‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç. ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æ®‡Ææ‡Æï‡Øç‡Æï‡ØÅ", level: "Hard" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æ®‡Æ§‡Æø'‡Æï‡Øç‡Æï‡ØÅ ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÅ?", a: "‡Æ®‡Æ§‡Æø ‡Æ®‡ØÄ‡Æ∞‡Øç ‡ÆÜ‡Æ£‡Øà‡ÆØ‡ÆÆ‡Øç", level: "Hard" },
            { q: "‡Æ®‡Ææ‡Æ©‡Øç ‡ÆÖ‡Æ¥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç, ‡Æ®‡Ææ‡Æ©‡Øç ‡Æµ‡ØÜ‡Æ≥‡Øç‡Æ≥‡Øà‡ÆØ‡Ææ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç. ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ©‡Øç‡Æ©?", a: "‡Æï‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æ≤‡Æï‡Øà", level: "Hard" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æï‡Æ©‡Æø'‡ÆØ‡Øà ‡Æµ‡Øá‡Æï‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æö‡Ææ‡Æ™‡Øç‡Æ™‡Æø‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æï‡Æ£‡Æø‡Æ§‡ÆÆ‡Øç", level: "Hard" },
            
            // Impossible - The most difficult, highly specific wordplay
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡ÆÆ‡Ææ‡Æ≤‡Øà'‡ÆØ‡Øà ‡ÆÖ‡Æ£‡Æø‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç ‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡Æµ‡Æ≤‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÅ?", a: "‡Æµ‡Ææ‡Æ©‡ÆÆ‡Øç", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æ§‡Æ≤‡Øà'‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÅ?", a: "‡Æ§‡Æ≤‡Øà‡Æ™‡Øç‡Æ™‡Ææ‡Æï‡Øà", level: "Impossible" },
            { q: "‡ÆØ‡Ææ‡Æ∞‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øá ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡Øà‡Æï‡Øç ‡Æï‡Øá‡Æü‡Øç‡Æ™‡Ææ‡Æ∞‡Øç, ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç ‡Æí‡Æ∞‡ØÅ‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Æ≥‡Æø‡Æï‡Øç‡Æï ‡ÆÆ‡Ææ‡Æü‡Øç‡Æü‡Ææ‡Æ∞‡Øç?", a: "‡Æ§‡Øä‡Æ≤‡Øà‡Æ™‡Øá‡Æö‡Æø", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æµ‡Øá‡Æ≤‡Øà'‡Æï‡Øç‡Æï‡ØÅ ‡Æö‡ÆÆ‡Øç‡Æ™‡Æ≥‡ÆÆ‡Øç ‡Æ§‡Æ∞ ‡ÆÆ‡Ææ‡Æü‡Øç‡Æü‡Ææ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç?", a: "‡Æµ‡ØÄ‡Æü‡Øç‡Æü‡ØÅ ‡Æµ‡Øá‡Æ≤‡Øà", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æ™‡ØÜ‡Æü‡Øç‡Æü‡Æø'‡Æï‡Øç‡Æï‡ØÅ‡Æ≥‡Øç‡Æ≥‡Øá‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æé‡Æ§‡ØÅ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÅ?", a: "‡Æö‡Æµ‡Æ™‡Øç‡Æ™‡ØÜ‡Æü‡Øç‡Æü‡Æø", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡ÆÆ‡ØÄ‡Æ©‡Øç'‡Æ©‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ®‡ØÄ‡Æö‡Øç‡Æö‡Æ≤‡Øç ‡Æ§‡ØÜ‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡ÆÆ‡ØÄ‡Æ©‡Øç ‡Æï‡ØÅ‡Æ¥‡ÆÆ‡Øç‡Æ™‡ØÅ", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æ™‡Æ¥‡ÆÆ‡Øç'‡ÆÆ‡Øà ‡Æ™‡Æ±‡Æø‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æ™‡Æ¥‡Øà‡ÆØ ‡Æï‡Æ§‡Øà", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æâ‡Æü‡Øà'‡ÆØ‡Øà ‡Æï‡Æø‡Æ¥‡Æø‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æâ‡Æü‡Æ©‡Øç‡Æ™‡Ææ‡Æü‡ØÅ", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡ÆÆ‡Æ≤‡Øà'‡ÆØ‡Øà ‡Æè‡Æ± ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ?", a: "‡Æµ‡Æø‡Æ≥‡ÆÆ‡Øç‡Æ™‡Æ∞ ‡ÆÆ‡Æ≤‡Øà", level: "Impossible" },
            { q: "‡Æé‡Æ®‡Øç‡Æ§ ‡Æí‡Æ∞‡ØÅ '‡Æï‡ØÅ‡Æ∞‡Æô‡Øç‡Æï‡ØÅ' ‡ÆÆ‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æ§‡Øä‡Æô‡Øç‡Æï‡Ææ‡Æ§‡ØÅ?", a: "‡Æï‡ØÅ‡Æ∞‡Æô‡Øç‡Æï‡ØÅ‡Æ™‡Øç ‡Æ™‡Æø‡Æü‡Æø", level: "Impossible" }
        ];

        // Function to ensure exactly 100 jokes per level by duplication (as requested)
        const REQUIRED_COUNT = 100;
        function padJokes(jokes) {
            const paddedJokes = [];
            const groupedJokes = {};

            jokes.forEach(joke => {
                if (!groupedJokes[joke.level]) groupedJokes[joke.level] = [];
                groupedJokes[joke.level].push(joke);
            });

            for (const level in groupedJokes) {
                let currentJokes = groupedJokes[level];
                if (currentJokes.length > 0) {
                    let index = 0;
                    while (paddedJokes.filter(j => j.level === level).length < REQUIRED_COUNT) {
                        const originalJoke = currentJokes[index % currentJokes.length];
                        
                        const qNum = paddedJokes.filter(j => j.level === level).length + 1;
                        const qSuffix = index >= currentJokes.length ? ` (Q${qNum})` : '';

                        paddedJokes.push({ 
                            ...originalJoke,
                            q: originalJoke.q + qSuffix, 
                        });
                        index++;
                    }
                }
            }
            return paddedJokes;
        }

        const ALL_JOKES = padJokes(BASE_JOKES);


        // --- Game State Variables ---
        let score = 0;
        let selectedTime = null; 
        let selectedLevel = null;
        let filteredJokes = []; 
        let currentJokeIndex = 0;
        let timerInterval = null;
        let timeLeft = 0;
        let isDarkMode = true; // Tracks the current theme mode

        // --- UI Element References ---
        const body = document.body;
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const startGameButton = document.getElementById('start-game-button');
        const timeOptionsContainer = document.getElementById('time-options');
        const levelOptionsContainer = document.getElementById('level-options');
        const scoreDisplay = document.getElementById('score-display');
        const timerDisplay = document.getElementById('timer-display');
        const timerBar = document.getElementById('timer-bar');
        const questionEl = document.getElementById('joke-question');
        const optionsContainer = document.getElementById('options-container');
        const finalScoreDisplay = document.getElementById('final-score-display');
        const levelIndicator = document.getElementById('level-indicator');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        
        // --- Theme Toggle Function ---

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            if (isDarkMode) {
                body.setAttribute('data-theme', 'dark');
                darkModeToggle.textContent = 'üåô';
            } else {
                body.setAttribute('data-theme', 'light');
                darkModeToggle.textContent = '‚òÄÔ∏è';
            }
            // Re-render timer bar color based on new theme
            updateTimerBarColor();
        }

        function updateTimerBarColor(percentage = 100) {
            const bar = document.getElementById('timer-bar');
            
            // Set initial color based on theme
            let initialColor = isDarkMode ? '#10b981' : '#1d4ed8'; // Green (Dark) or Blue (Light)
            
            if (percentage <= 25) {
                initialColor = isDarkMode ? '#ef4444' : '#b91c1c'; // Red (Dark) or Dark Red (Light)
            } else if (percentage <= 50) {
                initialColor = isDarkMode ? '#f59e0b' : '#d97706'; // Amber (Dark) or Dark Amber (Light)
            }
            
            bar.style.backgroundColor = initialColor;
        }
        
        // --- Game Setup Functions ---

        const TIME_OPTIONS = [10, 15, 20, 25, 30];
        const LEVEL_OPTIONS = ["Easy", "Intermediate", "Hard", "Impossible"];

        function showScreen(screenId) {
            startScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
        }

        function toggleStartButton() {
            if (selectedTime !== null && selectedLevel !== null) {
                startGameButton.disabled = false;
                startGameButton.classList.remove('bg-gray-500', 'cursor-not-allowed', 'opacity-70');
                startGameButton.classList.add('bg-orange-600', 'hover:bg-orange-700');
            } else {
                startGameButton.disabled = true;
                startGameButton.classList.add('bg-gray-500', 'cursor-not-allowed', 'opacity-70');
                startGameButton.classList.remove('bg-orange-600', 'hover:bg-orange-700');
            }
        }

        function createSelectionButtons() {
            // Time Buttons
            TIME_OPTIONS.forEach(time => {
                const button = document.createElement('button');
                button.textContent = `${time} ‡Æµ‡Æø‡Æ©‡Ææ‡Æü‡Æø‡Æï‡Æ≥‡Øç`;
                // Note: Using explicit color class here since variable usage for button color in this structure is complex with Tailwind
                button.className = 'time-button button-style bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-lg text-lg';
                button.onclick = () => {
                    selectedTime = time;
                    document.querySelectorAll('.time-button').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    toggleStartButton();
                };
                timeOptionsContainer.appendChild(button);
            });

            // Level Buttons
            const levelColors = {
                "Easy": "bg-green-500 hover:bg-green-600",
                "Intermediate": "bg-yellow-500 hover:bg-yellow-600",
                "Hard": "bg-red-500 hover:bg-red-600",
                "Impossible": "bg-purple-500 hover:bg-purple-600"
            };
            LEVEL_OPTIONS.forEach(level => {
                const button = document.createElement('button');
                button.textContent = level;
                button.className = `level-button button-style ${levelColors[level]} text-white py-3 rounded-lg text-lg`;
                button.onclick = () => {
                    selectedLevel = level;
                    document.querySelectorAll('.level-button').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    toggleStartButton();
                };
                levelOptionsContainer.appendChild(button);
            });
        }

        // --- Game Logic ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            if (selectedTime === null || selectedLevel === null) return;

            // 1. Filter, Initialize State, and Shuffle Jokes
            filteredJokes = ALL_JOKES.filter(joke => joke.level === selectedLevel)
                .map(joke => ({
                    ...joke,
                    isAnswered: false, 
                    isCorrect: false,  
                    selectedOption: null 
                }));
            shuffleArray(filteredJokes);

            if (filteredJokes.length === 0) {
                questionEl.textContent = "‡Æá‡Æ®‡Øç‡Æ§ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡Æµ‡Æø‡Æü‡ØÅ‡Æï‡Æ§‡Øà‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà. ‡Æµ‡Øá‡Æ±‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.";
                return;
            }

            // 2. Initialize State
            score = 0;
            currentJokeIndex = 0;
            scoreDisplay.textContent = score;
            levelIndicator.textContent = selectedLevel;

            // 3. Show Game Screen and Load First Joke
            showScreen('game-screen');
            loadJoke();
        }
        
        // --- Navigation Handlers ---

        function goToPreviousJoke() {
            if (currentJokeIndex > 0) {
                currentJokeIndex--;
                loadJoke();
            }
        }

        function goToNextJoke() {
            const currentJoke = filteredJokes[currentJokeIndex];
            
            if (currentJokeIndex < filteredJokes.length - 1) {
                currentJokeIndex++;
                loadJoke();
            } else if (currentJokeIndex === filteredJokes.length - 1 && currentJoke.isAnswered) {
                // If on the last question and answered, go to End Screen
                endGame();
            }
        }

        function updateNavigationButtons() {
            const totalJokes = filteredJokes.length;
            const currentJoke = filteredJokes[currentJokeIndex];
            const isLastQuestion = currentJokeIndex === totalJokes - 1;

            // Previous Button logic
            prevButton.disabled = currentJokeIndex === 0;
            if (currentJokeIndex === 0) {
                prevButton.classList.add('disabled-nav');
            } else {
                 prevButton.classList.remove('disabled-nav');
            }

            // Next Button logic
            if (isLastQuestion) {
                if(currentJoke.isAnswered) {
                     nextButton.textContent = "‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡Øà ‡ÆÆ‡ØÅ‡Æü‡Æø";
                     nextButton.onclick = endGame;
                     nextButton.classList.remove('disabled-nav');
                } else {
                    nextButton.textContent = "‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡Øà ‡ÆÆ‡ØÅ‡Æü‡Æø";
                    nextButton.onclick = endGame;
                    nextButton.classList.add('disabled-nav');
                    nextButton.disabled = true;
                }
            } else {
                nextButton.textContent = "‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø ‚Üí";
                nextButton.onclick = goToNextJoke;
                nextButton.classList.remove('disabled-nav');
                nextButton.disabled = false;
            }
        }


        // --- Timer Logic ---

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = selectedTime;
            timerDisplay.textContent = timeLeft;
            timerBar.style.display = 'block'; 
            
            updateTimerBarColor(100); 

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                
                // Update Timer Bar width and color
                const percentage = (timeLeft / selectedTime) * 100;
                timerBar.style.width = `${percentage}%`;
                updateTimerBarColor(percentage);
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeout(); 
                }
            }, 1000);
        }

        function handleTimeout() {
            const currentJoke = filteredJokes[currentJokeIndex];
            
            currentJoke.isAnswered = true;
            currentJoke.isCorrect = false;
            currentJoke.selectedOption = "‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ"; 

            // Disable all options and highlight correct answer in yellow
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-gray-600');
                
                if (btn.getAttribute('data-answer') === currentJoke.a) { 
                    btn.classList.remove('bg-gray-700');
                    // Use theme-neutral yellow/orange for timeout reveal
                    btn.classList.add('bg-yellow-600', 'border-4', 'border-yellow-300'); 
                }
            });

            const cleanAnswer = currentJoke.a.replace(/ \(Q\d+\)/, '');
            questionEl.textContent = `‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ! ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà: ${cleanAnswer}`;
            updateNavigationButtons();
        }

        // --- Option Rendering and Selection ---

        function getDistractors(correctAnswer, level) {
            const uniqueAnswers = Array.from(new Set(ALL_JOKES
                .filter(j => j.level === level && j.a !== correctAnswer) 
                .map(j => j.a)));
            
            shuffleArray(uniqueAnswers);

            const distractors = uniqueAnswers.slice(0, 3);
            while (distractors.length < 3) {
                distractors.push(`‡Æµ‡Æø‡Æü‡Øà`);
            }
            return distractors;
        }


        function renderOptions(joke) {
            optionsContainer.innerHTML = '';
            const { a: correctAnswer, level, isAnswered, selectedOption, isCorrect } = joke;

            // Render options only if needed, otherwise use saved options if possible
            const distractors = getDistractors(correctAnswer, level);
            const options = [correctAnswer, ...distractors];
            shuffleArray(options); // Shuffle on every load

            options.forEach((option) => {
                const button = document.createElement('button');
                button.textContent = option.replace(/ \(Q\d+\)/, ''); 
                button.setAttribute('data-answer', option); 
                
                // Use style for background color to allow theme changes to affect button text on select
                button.className = `option-button button-style bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg text-lg text-left w-full shadow-md`;
                button.onclick = () => selectOption(option, button);
                
                if (isAnswered) {
                    button.disabled = true;
                    button.classList.remove('hover:bg-gray-600');
                    
                    if (option === correctAnswer) {
                        // Correct: Green highlight (theme-independent)
                        button.classList.remove('bg-gray-700');
                        button.classList.add('bg-green-600', 'border-4', 'border-lime-300');
                    } else if (option === selectedOption && !isCorrect && selectedOption !== "‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ") {
                        // Incorrect selection: Red highlight (theme-independent)
                        button.classList.remove('bg-gray-700');
                        button.classList.add('bg-red-600', 'border-4', 'border-red-300');
                    } else if (selectedOption === "‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ" && option === correctAnswer) {
                        // Timeout: Yellow/Orange highlight (theme-independent)
                         button.classList.remove('bg-gray-700');
                         button.classList.add('bg-yellow-600', 'border-4', 'border-yellow-300');
                    }
                }
                
                optionsContainer.appendChild(button);
            });
        }


        function selectOption(selectedAnswer, selectedButton) {
            clearInterval(timerInterval);
            const currentJoke = filteredJokes[currentJokeIndex];
            const isCorrect = selectedAnswer === currentJoke.a;

            // 1. Save state
            if (!currentJoke.isAnswered) { // Only update score/state if answering for the first time
                currentJoke.isAnswered = true;
                currentJoke.isCorrect = isCorrect;
                currentJoke.selectedOption = selectedAnswer;
            
                if (isCorrect) {
                    score += 10;
                    scoreDisplay.textContent = score;
                }
            }


            // 2. Highlighting 
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-gray-600');
                
                if (btn.getAttribute('data-answer') === currentJoke.a) {
                    btn.classList.remove('bg-gray-700');
                    btn.classList.add('bg-green-600', 'border-4', 'border-lime-300');
                } else if (btn === selectedButton) {
                    btn.classList.remove('bg-gray-700');
                    btn.classList.add('bg-red-600', 'border-4', 'border-red-300');
                }
            });

            // 3. Update Message
            const cleanAnswer = currentJoke.a.replace(/ \(Q\d+\)/, '');
            if (isCorrect) {
                questionEl.textContent = `‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà! (${cleanAnswer}) - +10 ‡Æ∏‡Øç‡Æï‡Øã‡Æ∞‡Øç!`;
            } else {
                questionEl.textContent = `‡Æ§‡Æµ‡Æ±‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà. ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà: ${cleanAnswer}`;
            }
            
            // 4. Update Navigation Buttons
            updateNavigationButtons();
        }

        // --- Main Loader ---

        function loadJoke() {
            if (currentJokeIndex >= filteredJokes.length) {
                endGame();
                return;
            }

            const joke = filteredJokes[currentJokeIndex];
            
            // 1. Clear Timer & Update Bar Display
            clearInterval(timerInterval);
            timerDisplay.textContent = selectedTime;
            
            // 2. Update content
            const cleanQuestion = joke.q.replace(/ \(Q\d+\)$/, '');
            // Display Question Number in the question text
            questionEl.textContent = `${currentJokeIndex + 1} / ${filteredJokes.length}: ${cleanQuestion}`;
            
            // 3. Render Options & State Check
            renderOptions(joke);
            
            // 4. Update Navigation
            updateNavigationButtons();
            
            // 5. Start Timer ONLY if not answered
            if (!joke.isAnswered) {
                timerBar.style.display = 'block';
                startTimer();
            } else {
                // If already answered, hide the timer bar and show status
                timerBar.style.display = 'none';
                const cleanAnswer = joke.a.replace(/ \(Q\d+\)/, '');
                if (joke.selectedOption === "‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ") {
                    questionEl.textContent = `‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ. ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà: ${cleanAnswer}`;
                } else if (joke.isCorrect) {
                    questionEl.textContent = `‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà! (${cleanAnswer})`;
                } else {
                    questionEl.textContent = `‡Æ§‡Æµ‡Æ±‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà. ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡Æø‡Æü‡Øà: ${cleanAnswer}`;
                }
            }
        }


        function endGame() {
            clearInterval(timerInterval);
            finalScoreDisplay.textContent = score;
            showScreen('end-screen');
        }

        // --- Initialization ---
        window.onload = () => {
            // Initialize theme to dark mode (default)
            toggleDarkMode(); 
            isDarkMode = false; // Toggle will set it back to true, so start false here

            createSelectionButtons();
            showScreen('start-screen');
        };
    </script>
</body>
</html>
